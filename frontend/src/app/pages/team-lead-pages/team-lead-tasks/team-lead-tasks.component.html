<team-lead-navbar />
<main class="p-10">
  <div class="flex flex-col gap-5">
    <h1 class="text-2xl font-bold">Tasks</h1>
    <hr />
  </div>
  <div class="mt-5 w-full">
    <div class="w-full">
      <div class="flex justify-between gap-4">
        <input
          hlmInput
          class="w-full md:w-80"
          placeholder="Filter tasks..."
          [ngModel]="_taskFilter()"
          (ngModelChange)="_rawFilterInput.set($event)"
        />

        <button hlmBtn variant="outline" align="end" [brnMenuTriggerFor]="menu">
          <p>Columns</p>
          <ng-icon name="lucideChevronDown" class="ml-2" />
        </button>
        <ng-template #menu>
          <hlm-menu class="w-32">
            @for (
                    column of _brnColumnManager.allColumns;
                track column.name
              ) {
              <button
                hlmMenuItemCheckbox
                [disabled]="_brnColumnManager.isColumnDisabled(column.name)"
                [checked]="_brnColumnManager.isColumnVisible(column.name)"
                (triggered)="_brnColumnManager.toggleVisibility(column.name)"
              >
                <hlm-menu-item-check />
                <span>{{ column.label }}</span>
              </button>
            }
          </hlm-menu>
        </ng-template>
      </div>

      <brn-table
        hlm
        stickyHeader
        class="border-border mt-4 block h-[51vh] overflow-auto custom-scrollbar rounded-md border w-full"
        [dataSource]="_filteredSortedPaginatedTasks()"
        [displayedColumns]="_allDisplayedColumns()"
        [trackBy]="_trackBy"
      >
        <brn-column-def name="select" class="w-12">
          <hlm-th *brnHeaderDef>
            <hlm-checkbox
              [checked]="_checkboxState()"
              (changed)="handleHeaderCheckboxChange()"
            />
          </hlm-th>
          <hlm-td *brnCellDef="let element">
            <hlm-checkbox
              [checked]="_isTaskSelected(element)"
              (changed)="toggleTask(element)"
            />
          </hlm-td>
        </brn-column-def>
        <brn-column-def name="title" class="w-40">
          <hlm-th truncate *brnHeaderDef>
            <button
              hlmBtn
              size="sm"
              variant="ghost"
              (click)="handleNameSortChange()"
            >
              Title
              <ng-icon class="ml-3" name="lucideArrowUpDown" />
            </button>
          </hlm-th>
          <hlm-td truncate *brnCellDef="let element">
            {{ element.title }}
          </hlm-td>
        </brn-column-def>
        <brn-column-def name="description" class="w-32">
          <hlm-th *brnHeaderDef>Description</hlm-th>
          <hlm-td truncate *brnCellDef="let element">{{ element.description }}</hlm-td>
        </brn-column-def>
        <brn-column-def name="status" class="w-40">
          <hlm-th *brnHeaderDef>Status</hlm-th>
          <hlm-td truncate *brnCellDef="let element">{{ element.status }}</hlm-td>
        </brn-column-def>
        <brn-column-def name="priority" class="w-40">
          <hlm-th *brnHeaderDef>Priority</hlm-th>
          <hlm-td truncate *brnCellDef="let element">{{ element.priority }}</hlm-td>
        </brn-column-def>
        <brn-column-def name="dueDate" class="w-40">
          <hlm-th *brnHeaderDef>Due Date</hlm-th>
          <hlm-td truncate *brnCellDef="let element">{{ element.dueDate | date: "short" }}</hlm-td>
        </brn-column-def>
        <brn-column-def name="dateAllocated" class="w-40">
          <hlm-th *brnHeaderDef>Date Allocated</hlm-th>
          <hlm-td truncate *brnCellDef="let element">{{ element.dateAllocated | date: "short" }}</hlm-td>
        </brn-column-def>
        <brn-column-def name="actions">
          <hlm-th *brnHeaderDef>Actions</hlm-th>
          <hlm-td *brnCellDef="let element">
            <button
              hlmBtn
              variant="ghost"
              size="icon"
              align="end"
              [brnMenuTriggerFor]="menu"
            >
              <ng-icon name="heroEllipsisHorizontal" />
            </button>

            <ng-template #menu>
              <hlm-menu>
                <hlm-menu-label>Actions</hlm-menu-label>
                <hlm-menu-separator />
                <hlm-menu-group>
                  <button hlmMenuItem>Copy Action</button>
                </hlm-menu-group>
                <hlm-menu-separator />
                <button hlmMenuItem>View Task</button>
              </hlm-menu>
            </ng-template>
          </hlm-td>
        </brn-column-def>
        <div
          class="flex items-center justify-center p-20 text-muted-foreground"
          brnNoDataRow
        >
          No data
        </div>
      </brn-table>

      <div
        class="flex flex-col justify-between mt-4 sm:flex-row sm:items-center"
        *brnPaginator="
          let ctx;
          totalElements: _totalElements();
          pageSize: _pageSize();
          onStateChange: _onStateChange
        "
      >
        <span class="${hlmMuted} text-sm"
        >{{ _selected().length }} of {{ _totalElements() }} row(s)
          selected</span
        >
        <div class="mt-2 flex items-center gap-5 sm:mt-0">

          <button hlmBtn variant="outline" align="end" size="sm" [brnMenuTriggerFor]="pageSizeTrigger">
            <p>{{ _pageSize() === 10000 ? "All" : _pageSize() }}</p>
            <ng-icon name="lucideChevronDown" class="ml-2" />
          </button>
          <ng-template #pageSizeTrigger>
            <hlm-menu class="w-32">
              @for (size of _availablePageSizes; track size) {
                <button
                  hlmMenuItemCheckbox
                  (click)="onOptionForPageSize(size)"
                >
                  <hlm-menu-item-check />
                  <span>{{ size === 10000 ? "All" : size }}</span>
                </button>
              }
            </hlm-menu>
          </ng-template>

          <div class="flex space-x-1">
            <button
              size="sm"
              variant="outline"
              hlmBtn
              [disabled]="!ctx.decrementable()"
              (click)="ctx.decrement()"
            >
              Previous
            </button>
            <button
              size="sm"
              variant="outline"
              hlmBtn
              [disabled]="!ctx.incrementable()"
              (click)="ctx.increment()"
            >
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>